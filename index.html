<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>JUKEN★QUEST – 教科別学習版</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    body { 
      font-family: "Noto Sans JP", sans-serif; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      touch-action: manipulation;
    }
    
* {
  -webkit-tap-highlight-color: transparent;
  -webkit-touch-callout: none;
}

/* ボタンのみ選択可能にする */
button {
  -webkit-user-select: none;
  user-select: none;
  pointer-events: auto;
  cursor: pointer;
}
    
    .modal { 
      display: none; 
      position: fixed; 
      inset: 0; 
      background: rgba(0,0,0,0.8); 
      align-items: center; 
      justify-content: center; 
      backdrop-filter: blur(5px);
      z-index: 1000;
    }
    .modal.show { display: flex; }
    
    .game-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      border: 1px solid rgba(255,255,255,0.2);
    }
    
    .hp-bar {
      transition: width 0.5s ease-in-out;
      background: linear-gradient(90deg, #ef4444, #f97316, #eab308);
    }
    
    .particle {
      position: absolute;
      pointer-events: none;
      font-weight: bold;
      z-index: 100;
      animation: floatUp 2s ease-out forwards;
    }
    
    @keyframes floatUp {
      0% { transform: translateY(0) scale(1); opacity: 1; }
      100% { transform: translateY(-100px) scale(1.2); opacity: 0; }
    }
    
    .shake {
      animation: shake 0.5s ease-in-out;
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }
    
    .bounce {
      animation: bounce 0.6s ease-in-out;
    }
    
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
      padding: 15px 20px;
      border-radius: 10px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
      transform: translateX(400px);
      transition: transform 0.3s ease-in-out;
      z-index: 1001;
    }
    
    .notification.show {
      transform: translateX(0);
    }
    
    .subject-btn {
      transition: all 0.3s ease;
    }
    
    .subject-btn.active {
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
      transform: scale(1.05);
    }
    
    .progress-ring {
      transform: rotate(-90deg);
    }
    
    .progress-ring-circle {
      transition: stroke-dashoffset 0.35s;
    }
  </style>
</head>
<body class="min-h-screen flex flex-col items-center pt-6 gap-6 relative overflow-x-hidden">

<!-- 教科選択モーダル -->
<div id="subjectModal" class="modal show">
  <div class="game-card p-8 w-full max-w-2xl mx-4">
    <div class="text-center mb-8">
      <h2 class="text-3xl font-black bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent mb-4">
        📚 教科を選択してください
      </h2>
      <p class="text-gray-600">学習したい教科を選んでゲームを開始しましょう！</p>
    </div>
    
<div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-6">
  <button class="subject-btn px-4 py-6 bg-white border-2 border-gray-200 rounded-xl hover:border-blue-400 transition-all duration-300" data-subject="history">
    <div class="text-2xl mb-2">🏛️</div>
    <div class="font-bold">歴史</div>
  </button>
  <button class="subject-btn px-4 py-6 bg-white border-2 border-gray-200 rounded-xl hover:border-blue-400 transition-all duration-300" data-subject="geography">
    <div class="text-2xl mb-2">🗺️</div>
    <div class="font-bold">地理</div>
  </button>
  <button class="subject-btn px-4 py-6 bg-white border-2 border-gray-200 rounded-xl hover:border-blue-400 transition-all duration-300" data-subject="civics">
    <div class="text-2xl mb-2">🏛️</div>
    <div class="font-bold">公民</div>
  </button>
  <button class="subject-btn px-4 py-6 bg-white border-2 border-gray-200 rounded-xl hover:border-blue-400 transition-all duration-300" data-subject="chemistry">
    <div class="text-2xl mb-2">🧪</div>
    <div class="font-bold">化学</div>
  </button>
  <button class="subject-btn px-4 py-6 bg-white border-2 border-gray-200 rounded-xl hover:border-blue-400 transition-all duration-300" data-subject="earth">
    <div class="text-2xl mb-2">🌍</div>
    <div class="font-bold">地学</div>
  </button>
  <button class="subject-btn px-4 py-6 bg-white border-2 border-gray-200 rounded-xl hover:border-blue-400 transition-all duration-300" data-subject="biology">
    <div class="text-2xl mb-2">🧬</div>
    <div class="font-bold">生物</div>
  </button>
  <button class="subject-btn px-4 py-6 bg-white border-2 border-gray-200 rounded-xl hover:border-blue-400 transition-all duration-300" data-subject="physics">
    <div class="text-2xl mb-2">⚛️</div>
    <div class="font-bold">物理</div>
  </button>
  <button class="subject-btn px-4 py-6 bg-white border-2 border-gray-200 rounded-xl hover:border-blue-400 transition-all duration-300" data-subject="english_words">
    <div class="text-2xl mb-2">📝</div>
    <div class="font-bold">英単語</div>
  </button>
  <button class="subject-btn px-4 py-6 bg-white border-2 border-gray-200 rounded-xl hover:border-blue-400 transition-all duration-300" data-subject="english_phrases">
    <div class="text-2xl mb-2">💬</div>
    <div class="font-bold">英熟語</div>
  </button>
</div>
    
    <div class="text-center">
      <button id="startGame" class="px-8 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg font-bold text-lg disabled:opacity-40 disabled:cursor-not-allowed">
        ゲーム開始
      </button>
    </div>
  </div>
</div>

<!-- タイトル -->
<div class="game-card p-6 text-center">
  <h1 class="text-4xl font-black bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent">
    JUKEN★QUEST 
    <span class="text-lg font-normal text-gray-600">(教科別学習版)</span>
  </h1>
  <div id="currentSubject" class="mt-2 text-lg font-medium text-gray-700"></div>
</div>

<!-- プレイヤー情報 -->
<div class="game-card p-6 w-full max-w-4xl">
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
    <!-- ステータス -->
    <div class="space-y-4">
      <h3 class="font-bold text-lg text-gray-800">プレイヤー情報</h3>
      <div id="stats" class="space-y-2 text-sm"></div>
      <div class="flex items-center gap-3">
        <span class="text-sm font-medium">Lv.</span>
        <div class="flex-1 bg-gray-200 rounded-full h-3">
          <div id="expBar" class="bg-gradient-to-r from-blue-500 to-purple-600 h-3 rounded-full transition-all duration-500"></div>
        </div>
        <span id="expText" class="text-xs text-gray-600"></span>
      </div>
    </div>
    
    <!-- 敵情報 -->
    <div class="space-y-4">
      <h3 class="font-bold text-lg text-gray-800">敵情報</h3>
      <div id="enemyInfo" class="space-y-2">
        <div id="enemyName" class="font-medium"></div>
        <div class="bg-gray-200 rounded-full h-4">
          <div id="hpBar" class="hp-bar h-4 rounded-full"></div>
        </div>
        <div id="enemyStats" class="text-xs text-gray-600"></div>
      </div>
    </div>
    
    <!-- 実績 -->
    <div class="space-y-4">
      <h3 class="font-bold text-lg text-gray-800">実績</h3>
      <div id="achievements" class="space-y-1 max-h-32 overflow-y-auto"></div>
    </div>
  </div>
</div>

<!-- 強化ボタン -->
<div class="game-card p-6 w-full max-w-4xl">
  <h3 class="font-bold text-lg text-gray-800 mb-4">学習強化メニュー</h3>
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
    <button id="upgradeAttack" class="px-6 py-4 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg shadow-lg hover:shadow-xl transition-all duration-300 disabled:opacity-40 disabled:cursor-not-allowed">
      <div class="font-bold text-lg">📚 基礎力強化</div>
      <div class="text-sm opacity-90 mt-1">暗記・基本問題でレベルアップ</div>
      <div class="text-sm opacity-90">￥<span id="attackCost">100</span></div>
    </button>
    
    <button id="upgradeCrit" class="px-6 py-4 bg-gradient-to-r from-yellow-500 to-yellow-600 text-white rounded-lg shadow-lg hover:shadow-xl transition-all duration-300 disabled:opacity-40 disabled:cursor-not-allowed">
      <div class="font-bold text-lg">🧠 応用力強化</div>
      <div class="text-sm opacity-90 mt-1">思考・応用問題でスキルアップ</div>
      <div class="text-sm opacity-90">￥<span id="critCost">200</span></div>
    </button>
    
    <button id="upgradeDefense" class="px-6 py-4 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg shadow-lg hover:shadow-xl transition-all duration-300 disabled:opacity-40 disabled:cursor-not-allowed">
      <div class="font-bold text-lg">🎯 発展力強化</div>
      <div class="text-sm opacity-90 mt-1">入試・発展問題で実力向上</div>
      <div class="text-sm opacity-90">￥<span id="defenseCost">150</span></div>
    </button>
  </div>
</div>

<!-- 教科変更ボタン -->
<div class="fixed bottom-4 left-4">
  <button id="changeSubject" class="w-16 h-16 bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-full shadow-lg hover:shadow-xl transition-all duration-300 text-2xl">
    📚
  </button>
</div>

<!-- クイズモーダル -->
<div id="quizModal" class="modal">
  <div class="game-card p-8 w-96 max-w-[90vw] relative">
    <div class="text-center mb-6">
      <h2 id="quizTitle" class="font-black text-2xl bg-gradient-to-r from-green-600 to-blue-600 bg-clip-text text-transparent">
        📚 基礎力問題
      </h2>
      <div class="mt-2">
        <svg class="progress-ring w-16 h-16 mx-auto" width="64" height="64">
          <circle class="progress-ring-circle" stroke="#e5e7eb" stroke-width="4" fill="transparent" r="28" cx="32" cy="32"/>
          <circle id="quizTimer" class="progress-ring-circle" stroke="#10b981" stroke-width="4" fill="transparent" r="28" cx="32" cy="32" stroke-dasharray="175.929" stroke-dashoffset="175.929"/>
        </svg>
      </div>
    </div>
    
    <div class="space-y-4">
      <p id="quizQ" class="text-lg font-medium text-center"></p>
      <div id="quizOptions" class="space-y-3"></div>
      <p id="quizMsg" class="mt-6 font-bold text-center text-lg"></p>
      <button id="quizClose" class="mt-4 w-full px-4 py-2 bg-gradient-to-r from-gray-500 to-gray-600 text-white rounded-lg hidden hover:from-gray-600 hover:to-gray-700 transition-all duration-300">
        閉じる
      </button>
    </div>
  </div>
</div>

<!-- 実績通知 -->
<div id="notification" class="notification">
  <div class="flex items-center gap-3">
    <span class="text-2xl">🏆</span>
    <div>
      <div class="font-bold">実績解除！</div>
      <div id="notificationText" class="text-sm opacity-90"></div>
    </div>
  </div>
</div>

<script>
/* ----------------- 問題データベース ----------------- */
const problemDatabase = {
  history: {
    basic: [
      {q:'鎌倉幕府を開いたのは？',opts:['源頼朝','平清盛','足利尊氏'],ans:0},
      {q:'室町幕府を開いたのは？',opts:['足利尊氏','足利義満','足利義政'],ans:0},
      {q:'江戸幕府を開いたのは？',opts:['織田信長','豊臣秀吉','徳川家康'],ans:2},
      {q:'本能寺の変で織田信長を討ったのは？',opts:['明智光秀','豊臣秀吉','徳川家康'],ans:0},
      {q:'関ヶ原の戦いが起きた年は？',opts:['1598年','1600年','1603年'],ans:1},
      {q:'大化の改新が起きた年は？',opts:['645年','646年','647年'],ans:0},
      {q:'平安京に遷都した天皇は？',opts:['桓武天皇','嵯峨天皇','清和天皇'],ans:0},
      {q:'源平合戦で源氏が勝利した戦いは？',opts:['一ノ谷の戦い','屋島の戦い','壇ノ浦の戦い'],ans:2},
      {q:'応仁の乱が起きた年は？',opts:['1467年','1477年','1487年'],ans:0},
      {q:'戦国時代を統一したのは？',opts:['織田信長','豊臣秀吉','徳川家康'],ans:1},
      {q:'鉄砲が日本に伝来した年は？',opts:['1543年','1549年','1553年'],ans:0},
      {q:'キリスト教を日本に伝えたのは？',opts:['フランシスコ・ザビエル','ルイス・フロイス','オルガンティノ'],ans:0},
      {q:'豊臣秀吉が行った政策は？',opts:['刀狩','参勤交代','鎖国'],ans:0},
      {q:'江戸時代の身分制度を何という？',opts:['士農工商','公家制度','荘園制'],ans:0},
      {q:'黒船来航の年は？',opts:['1853年','1854年','1855年'],ans:0},
      {q:'明治維新の年は？',opts:['1867年','1868年','1869年'],ans:1},
      {q:'大日本帝国憲法が発布された年は？',opts:['1889年','1890年','1891年'],ans:0},
      {q:'日清戦争が起きた年は？',opts:['1894年','1895年','1896年'],ans:0},
      {q:'日露戦争が起きた年は？',opts:['1904年','1905年','1906年'],ans:0},
      {q:'第一次世界大戦が始まった年は？',opts:['1914年','1915年','1916年'],ans:0}
    ],
    applied: [
      {q:'承久の乱の原因は？',opts:['朝廷と幕府の対立','元寇の脅威','農民の反乱'],ans:0},
      {q:'元寇が日本に与えた影響は？',opts:['武士の経済的困窮','朝廷の復権','農業の発達'],ans:0},
      {q:'南北朝時代が終わった理由は？',opts:['足利義満の統一','武士の疲弊','農民の支持'],ans:0},
      {q:'戦国時代が始まった原因は？',opts:['応仁の乱','一向一揆','農民の反乱'],ans:0},
      {q:'織田信長の革新的政策は？',opts:['楽市楽座','参勤交代','鎖国'],ans:0},
      {q:'豊臣秀吉の朝鮮出兵の目的は？',opts:['明征服','貿易拡大','武士の不満解消'],ans:0},
      {q:'江戸幕府の統治システムは？',opts:['幕藩体制','荘園制','律令制'],ans:0},
      {q:'鎖国政策の目的は？',opts:['キリスト教禁止','貿易統制','幕府権力維持'],ans:2},
      {q:'享保の改革を行ったのは？',opts:['徳川吉宗','田沼意次','松平定信'],ans:0},
      {q:'寛政の改革の特徴は？',opts:['緊縮財政','重商主義','開国政策'],ans:0},
      {q:'天保の改革が失敗した理由は？',opts:['財政難','外圧','農民反発'],ans:2},
      {q:'ペリー来航の目的は？',opts:['通商要求','植民地化','布教活動'],ans:0},
      {q:'安政の大獄の目的は？',opts:['開国反対派弾圧','尊王攘夷運動弾圧','外国人排斥'],ans:1},
      {q:'薩長同盟の意義は？',opts:['倒幕勢力結集','開国推進','攘夷実行'],ans:0},
      {q:'大政奉還の背景は？',opts:['幕府の政治的孤立','外国の圧力','天皇の要求'],ans:0},
      {q:'五箇条の御誓文の意義は？',opts:['新政府の方針表明','憲法制定','民主化宣言'],ans:0},
      {q:'廃藩置県の目的は？',opts:['中央集権化','地方分権','藩の自治'],ans:0},
      {q:'地租改正の意義は？',opts:['税制近代化','農民負担軽減','土地私有制確立'],ans:0},
      {q:'自由民権運動の要求は？',opts:['国会開設','不平等条約改正','富国強兵'],ans:0},
      {q:'日清戦争の結果は？',opts:['台湾獲得','朝鮮独立','遼東半島割譲'],ans:0}
    ],
    advanced: [
      {q:'院政が始まった背景にある政治的要因は？',opts:['摂関政治の限界','武士の台頭','荘園制の発達'],ans:0},
      {q:'平氏政権が短期間で滅亡した根本的原因は？',opts:['源氏の軍事力','貴族との対立','武士層の離反'],ans:2},
      {q:'鎌倉幕府の御家人制度の特徴は？',opts:['土地支配権の保障','血縁関係重視','契約的主従関係'],ans:2},
      {q:'蒙古襲来が日本社会に与えた長期的影響は？',opts:['武士の団結強化','幕府権威の失墜','外国意識の芽生え'],ans:1},
      {q:'室町幕府の政治的特徴は？',opts:['中央集権体制','連邦制的性格','絶対王政'],ans:1},
      {q:'戦国大名の領国経営の特徴は？',opts:['分国法制定','中央依存','宗教重視'],ans:0},
      {q:'織田信長の天下布武の真の意味は？',opts:['武力による統一','宗教改革','経済統制'],ans:0},
      {q:'豊臣政権の石高制の歴史的意義は？',opts:['全国統一基準','農業重視','武士優遇'],ans:0},
      {q:'江戸幕府の外交政策の基本原理は？',opts:['華夷秩序','孤立主義','選択的開国'],ans:2},
      {q:'元禄文化の社会的背景は？',opts:['武士文化の成熟','町人階級の台頭','農村の発展'],ans:1},
      {q:'享保の改革が目指した社会像は？',opts:['重農主義社会','重商主義社会','工業化社会'],ans:0},
      {q:'田沼時代の政治的特徴は？',opts:['重商主義政策','鎖国強化','身分制廃止'],ans:0},
      {q:'化政文化の特徴的性格は？',opts:['国際性','庶民性','宗教性'],ans:1},
      {q:'幕末の開国が日本社会に与えた衝撃は？',opts:['経済的混乱','政治的動揺','文化的変容'],ans:1},
      {q:'明治維新の世界史的意義は？',opts:['アジア初の近代化','西欧化の成功','植民地化回避'],ans:2},
      {q:'文明開化の本質的意味は？',opts:['西欧文明の導入','伝統文化の否定','近代的価値観の受容'],ans:2},
      {q:'富国強兵政策の歴史的背景は？',opts:['列強との対等化','国内統一','経済発展'],ans:0},
      {q:'自由民権運動の歴史的限界は？',opts:['民衆基盤の弱さ','政府の弾圧','外国の干渉'],ans:0},
      {q:'大日本帝国憲法の政治的性格は？',opts:['立憲君主制','絶対君主制','共和制'],ans:0},
      {q:'日清戦争後の三国干渉の歴史的意義は？',opts:['列強の対日警戒','アジア情勢の変化','日本の外交転換'],ans:2}
    ]
  },
  geography: {
    basic: [
      {q:'日本の首都は？',opts:['大阪','東京','京都'],ans:1},
      {q:'北海道の県庁所在地は？',opts:['札幌','函館','旭川'],ans:0},
      {q:'本州で最も高い山は？',opts:['富士山','白山','立山'],ans:0},
      {q:'日本で最も長い川は？',opts:['利根川','信濃川','石狩川'],ans:1},
      {q:'日本で最も大きい湖は？',opts:['琵琶湖','霞ヶ浦','サロマ湖'],ans:0},
      {q:'沖縄県の県庁所在地は？',opts:['那覇','石垣','宮古'],ans:0},
      {q:'青森県の県庁所在地は？',opts:['弘前','八戸','青森'],ans:2},
      {q:'宮城県の県庁所在地は？',opts:['仙台','石巻','気仙沼'],ans:0},
      {q:'新潟県の県庁所在地は？',opts:['長岡','上越','新潟'],ans:2},
      {q:'愛知県の県庁所在地は？',opts:['豊田','岡崎','名古屋'],ans:2},
      {q:'大阪府の府庁所在地は？',opts:['大阪','堺','東大阪'],ans:0},
      {q:'広島県の県庁所在地は？',opts:['呉','福山','広島'],ans:2},
      {q:'福岡県の県庁所在地は？',opts:['北九州','久留米','福岡'],ans:2},
      {q:'日本の最北端の島は？',opts:['択捉島','国後島','色丹島'],ans:0},
      {q:'日本の最南端の島は？',opts:['沖ノ鳥島','南鳥島','与那国島'],ans:0},
      {q:'日本海に面していない県は？',opts:['青森県','岩手県','秋田県'],ans:1},
      {q:'太平洋に面していない県は？',opts:['茨城県','栃木県','千葉県'],ans:1},
      {q:'内陸県はいくつある？',opts:['6県','7県','8県'],ans:2},
      {q:'日本の面積は約何万km²？',opts:['28万','33万','38万'],ans:2},
      {q:'日本の人口は約何億人？',opts:['1億','1.2億','1.5億'],ans:1}
    ],
    applied: [
      {q:'日本の気候区分で、北海道の大部分は？',opts:['亜寒帯','温帯','亜熱帯'],ans:0},
      {q:'梅雨前線の影響を受けにくい地域は？',opts:['北海道','東北','九州'],ans:0},
      {q:'台風の影響を最も受けやすい地域は？',opts:['北海道','本州','沖縄'],ans:2},
      {q:'日本海側の冬の特徴は？',opts:['乾燥','多雨','多雪'],ans:2},
      {q:'太平洋側の冬の特徴は？',opts:['多雪','乾燥','多雨'],ans:1},
**はい、静音・タップ拡大防止対応済みです！** また、理科は中学範囲に限定いたします。続きをお送りします。

```javascript
      {q:'瀬戸内海式気候の特徴は？',opts:['降水量が少ない','台風が多い','雪が多い'],ans:0},
      {q:'日本の農業で最も生産量が多い作物は？',opts:['米','小麦','大豆'],ans:0},
      {q:'北海道の代表的な農業は？',opts:['稲作','畑作','果樹栽培'],ans:1},
      {q:'九州地方の代表的な工業は？',opts:['鉄鋼業','化学工業','自動車工業'],ans:1},
      {q:'中京工業地帯の中心工業は？',opts:['繊維工業','自動車工業','造船業'],ans:1},
      {q:'京浜工業地帯の特徴は？',opts:['重化学工業','軽工業','農業'],ans:0},
      {q:'阪神工業地帯の発達要因は？',opts:['原料産地','消費地','交通の便'],ans:2},
      {q:'日本の貿易相手国第1位は？',opts:['アメリカ','中国','韓国'],ans:1},
      {q:'日本の輸出品第1位は？',opts:['自動車','機械類','鉄鋼'],ans:1},
      {q:'日本の輸入品第1位は？',opts:['原油','食料品','原材料'],ans:0},
      {q:'過疎化が進む地域の特徴は？',opts:['都市部','山間部','沿岸部'],ans:1},
      {q:'都市化の問題点は？',opts:['人口減少','交通渋滞','農業衰退'],ans:1},
      {q:'地球温暖化の原因は？',opts:['二酸化炭素増加','オゾン層破壊','酸性雨'],ans:0},
      {q:'酸性雨の原因は？',opts:['二酸化炭素','硫黄酸化物','メタンガス'],ans:1},
      {q:'リサイクルの3Rに含まれないのは？',opts:['Reduce','Reuse','Refuse'],ans:2}
    ],
    advanced: [
      {q:'日本の地形形成に最も影響を与えた要因は？',opts:['火山活動','氷河作用','風化作用'],ans:0},
      {q:'環太平洋造山帯の特徴として正しいのは？',opts:['地震が少ない','火山が多い','平野が広い'],ans:1},
      {q:'日本の河川の特徴は？',opts:['流路が長い','勾配が急','水量が豊富'],ans:1},
      {q:'日本の海岸線の特徴は？',opts:['単調','複雑','直線的'],ans:1},
      {q:'モンスーンアジアの農業の特徴は？',opts:['粗放的農業','集約的農業','遊牧'],ans:1},
      {q:'日本の人口分布の特徴は？',opts:['均等分布','太平洋ベルト集中','日本海側集中'],ans:1},
      {q:'高齢化社会の定義は？',opts:['高齢化率7%以上','高齢化率14%以上','高齢化率21%以上'],ans:1},
      {q:'少子化の主な原因は？',opts:['経済的負担','価値観の変化','両方'],ans:2},
      {q:'地域格差の要因として最も重要なのは？',opts:['自然条件','交通条件','歴史的条件'],ans:1},
      {q:'持続可能な発展の概念に含まれるのは？',opts:['経済発展のみ','環境保護のみ','両方の調和'],ans:2},
      {q:'グローバル化の影響として正しいのは？',opts:['地域性の消失','文化の画一化','経済の相互依存'],ans:2},
      {q:'情報化社会の特徴は？',opts:['情報の価値向上','距離の意味変化','両方'],ans:2},
      {q:'都市問題の解決策として有効なのは？',opts:['人口制限','機能分散','交通整備'],ans:1},
      {q:'環境問題の解決に必要なのは？',opts:['技術革新','国際協力','両方'],ans:2},
      {q:'地球規模の環境問題でないのは？',opts:['地球温暖化','オゾン層破壊','騒音問題'],ans:2},
      {q:'持続可能な農業の条件は？',opts:['大量生産','環境保全','機械化'],ans:1},
      {q:'エネルギー問題の解決策は？',opts:['原子力拡大','再生可能エネルギー','化石燃料増産'],ans:1},
      {q:'水資源問題の原因は？',opts:['気候変動','人口増加','両方'],ans:2},
      {q:'食料問題の解決に必要なのは？',opts:['生産量増加','流通改善','両方'],ans:2},
      {q:'国際協力が必要な問題は？',opts:['地域紛争','環境問題','両方'],ans:2}
    ]
  },
  civics: {
    basic: [
      {q:'日本国憲法が施行された年は？',opts:['1946年','1947年','1948年'],ans:1},
      {q:'日本国憲法の三大原理に含まれないのは？',opts:['国民主権','基本的人権','国際協調'],ans:2},
      {q:'国会は何院制？',opts:['一院制','二院制','三院制'],ans:1},
      {q:'衆議院の任期は？',opts:['3年','4年','6年'],ans:1},
      {q:'参議院の任期は？',opts:['4年','6年','8年'],ans:1},
      {q:'内閣総理大臣を指名するのは？',opts:['天皇','国会','国民'],ans:1},
      {q:'最高裁判所の裁判官を任命するのは？',opts:['国会','内閣','天皇'],ans:1},
      {q:'選挙権を得られる年齢は？',opts:['18歳','20歳','25歳'],ans:0},
      {q:'被選挙権（衆議院）を得られる年齢は？',opts:['20歳','25歳','30歳'],ans:1},
      {q:'被選挙権（参議院）を得られる年齢は？',opts:['25歳','30歳','35歳'],ans:1},
      {q:'地方自治体の長を選ぶ選挙は？',opts:['直接選挙','間接選挙','任命制'],ans:0},
      {q:'基本的人権で「自由権」に含まれるのは？',opts:['選挙権','表現の自由','生存権'],ans:1},
      {q:'基本的人権で「社会権」に含まれるのは？',opts:['信教の自由','教育を受ける権利','財産権'],ans:1},
      {q:'基本的人権で「参政権」に含まれるのは？',opts:['選挙権','居住の自由','裁判を受ける権利'],ans:0},
      {q:'三権分立の「三権」に含まれないのは？',opts:['立法権','行政権','選挙権'],ans:2},
      {q:'法律を作るのは？',opts:['内閣','国会','裁判所'],ans:1},
      {q:'法律を実行するのは？',opts:['内閣','国会','裁判所'],ans:0},
      {q:'法律を解釈するのは？',opts:['内閣','国会','裁判所'],ans:2},
      {q:'税金の種類で国税でないのは？',opts:['所得税','消費税','住民税'],ans:2},
      {q:'地方税でないのは？',opts:['住民税','固定資産税','法人税'],ans:2}
    ],
    applied: [
      {q:'国民主権の具体的な現れは？',opts:['選挙制度','基本的人権','平和主義'],ans:0},
      {q:'基本的人権の制約原理は？',opts:['公共の福祉','国家の利益','多数決'],ans:0},
      {q:'平和主義の具体的内容は？',opts:['戦争放棄','軍備撤廃','中立政策'],ans:0},
      {q:'国会の最高機関性の意味は？',opts:['他の機関より上位','国民代表機関','法律制定権'],ans:1},
      {q:'内閣の連帯責任の意味は？',opts:['個別責任','集団責任','無責任'],ans:1},
      {q:'司法権の独立の意味は？',opts:['政治的中立','行政からの独立','立法からの独立'],ans:1},
      {q:'違憲審査制の目的は？',opts:['憲法の保障','法律の制定','政治の安定'],ans:0},
      {q:'地方自治の本旨とは？',opts:['中央集権','住民自治','官僚統制'],ans:1},
      {q:'直接民主制の例は？',opts:['選挙','住民投票','議会'],ans:1},
      {q:'間接民主制の例は？',opts:['住民投票','選挙','世論調査'],ans:1},
      {q:'政党政治の意義は？',opts:['政治の安定','民意の反映','権力の集中'],ans:1},
      {q:'選挙制度の原則でないのは？',opts:['普通選挙','秘密選挙','制限選挙'],ans:2},
      {q:'世論の政治への影響は？',opts:['直接的','間接的','無関係'],ans:1},
      {q:'マスメディアの役割は？',opts:['娯楽提供','情報伝達','政治参加'],ans:1},
      {q:'NPOの特徴は？',opts:['営利目的','非営利目的','政府機関'],ans:1},
      {q:'国際連合の目的は？',opts:['世界政府','国際平和','経済発展'],ans:1},
      {q:'国際法の特徴は？',opts:['強制力あり','強制力なし','部分的強制力'],ans:2},
      {q:'人権の国際化の意味は？',opts:['国内問題','国際問題','個人問題'],ans:1},
      {q:'グローバル化の政治への影響は？',opts:['国家主権強化','国家主権制約','変化なし'],ans:1},
      {q:'環境問題の解決に必要なのは？',opts:['国内対策','国際協力','技術革新'],ans:1}
    ],
    advanced: [
      {q:'立憲主義の本質は？',opts:['国民主権','権力制限','民主主義'],ans:1},
      {q:'法の支配の意味は？',opts:['法律万能','権力の法的拘束','国民の法的拘束'],ans:1},
      {q:'民主主義の正統性の根拠は？',opts:['効率性','国民の同意','伝統'],ans:1},
      {q:'基本的人権の普遍性とは？',opts:['時代を超越','地域を超越','人類共通'],ans:2},
      {q:'自由権の歴史的性格は？',opts:['新しい権利','古典的権利','未来の権利'],ans:1},
      {q:'社会権の歴史的意義は？',opts:['自由の制限','平等の実現','効率の追求'],ans:1},
      {q:'新しい人権の背景は？',opts:['技術発展','社会変化','両方'],ans:2},
      {q:'権力分立の現代的課題は？',opts:['分立の徹底','協力の必要','統合の推進'],ans:1},
      {q:'議院内閣制の特徴は？',opts:['権力分立','権力融合','権力集中'],ans:1},
      {q:'大統領制との違いは？',opts:['任期の長さ','選出方法','責任の取り方'],ans:2},
      {q:'司法の政治性とは？',opts:['政治への関与','政治からの独立','政治的中立'],ans:0},
      {q:'違憲審査制の課題は？',opts:['司法の政治化','民主的正統性','両方'],ans:2},
      {q:'地方分権の意義は？',opts:['効率性向上','民主主義深化','両方'],ans:2},
      {q:'住民参加の課題は？',opts:['無関心','専門性不足','両方'],ans:2},
      {q:'政治参加の多様化とは？',opts:['選挙以外の参加','インターネット活用','両方'],ans:2},
      {q:'世論と民意の関係は？',opts:['同一','異なる','部分的同一'],ans:1},
      {q:'メディアリテラシーの重要性は？',opts:['情報の選別','批判的思考','両方'],ans:2},
      {q:'市民社会の役割は？',opts:['政府の補完','政府の監視','両方'],ans:2},
      {q:'グローバル・ガバナンスとは？',opts:['世界政府','国際協調','地域統合'],ans:1},
      {q:'人間の安全保障の概念は？',opts:['国家中心','個人中心','地域中心'],ans:1}
    ]
  },
  chemistry: {
    basic: [
      {q:'水の化学式は？',opts:['H2O','CO2','NaCl'],ans:0},
      {q:'二酸化炭素の化学式は？',opts:['H2O','CO2','O2'],ans:1},
      {q:'酸素の化学式は？',opts:['O','O2','O3'],ans:1},
      {q:'水素の化学式は？',opts:['H','H2','H3'],ans:1},
      {q:'食塩の化学式は？',opts:['NaCl','KCl','CaCl2'],ans:0},
      {q:'元素記号でFeが表すのは？',opts:['銅','鉄','銀'],ans:1},
      {q:'元素記号でCuが表すのは？',opts:['銅','鉄','炭素'],ans:0},
      {q:'元素記号でAgが表すのは？',opts:['金','銀','アルミニウム'],ans:1},
      {q:'元素記号でAuが表すのは？',opts:['金','銀','アルミニウム'],ans:0},
      {q:'元素記号でAlが表すのは？',opts:['金','銀','アルミニウム'],ans:2},
      {q:'原子の中心にあるのは？',opts:['電子','原子核','中性子'],ans:1},
      {q:'原子核の周りを回っているのは？',opts:['電子','陽子','中性子'],ans:0},
      {q:'原子番号は何の数？',opts:['電子数','陽子数','中性子数'],ans:1},
      {q:'質量数は何の合計？',opts:['陽子と電子','陽子と中性子','電子と中性子'],ans:1},
      {q:'イオンとは何？',opts:['電気を帯びた原子','中性の原子','化合物'],ans:0},
      {q:'酸性の水溶液は何色？',opts:['赤色','青色','緑色'],ans:0},
      {q:'アルカリ性の水溶液は何色？',opts:['赤色','青色','緑色'],ans:1},
      {q:'中性の水溶液のpHは？',opts:['7','14','0'],ans:0},
      {q:'燃焼に必要な気体は？',opts:['酸素','窒素','二酸化炭素'],ans:0},
      {q:'光合成で作られる気体は？',opts:['酸素','二酸化炭素','窒素'],ans:0}
    ],
    applied: [
      {q:'原子の構造で、陽子と中性子があるのは？',opts:['電子殻','原子核','軌道'],ans:1},
      {q:'同位体とは何が異なる原子？',opts:['陽子数','電子数','中性子数'],ans:2},
      {q:'イオン化傾向が大きい金属は？',opts:['金','銀','カリウム'],ans:2},
      {q:'酸化とは何を失うこと？',opts:['電子','陽子','中性子'],ans:0},
      {q:'還元とは何を得ること？',opts:['電子','陽子','中性子'],ans:0},
      {q:'化学反応式で、左辺は？',opts:['生成物','反応物','触媒'],ans:1},
      {q:'化学反応式で、右辺は？',opts:['生成物','反応物','触媒'],ans:0},
      {q:'触媒の働きは？',opts:['反応速度を速める','反応を止める','反応物になる'],ans:0},
      {q:'中和反応で生成されるのは？',opts:['酸と塩基','塩と水','酸と水'],ans:1},
      {q:'電解質とは何？',opts:['電気を通す物質','電気を通さない物質','金属'],ans:0},
      {q:'分子とは何？',opts:['原子の集まり','イオンの集まり','電子の集まり'],ans:0},
      {q:'化合物とは何？',opts:['同じ原子の集まり','異なる原子の集まり','イオンの集まり'],ans:1},
      {q:'混合物とは何？',opts:['純物質の集まり','化合物','元素'],ans:0},
      {q:'溶解度とは何？',opts:['溶ける量','溶ける速さ','溶ける温度'],ans:0},
      {q:'飽和水溶液とは？',opts:['これ以上溶けない','まだ溶ける','薄い水溶液'],ans:0},
      {q:'結晶とは何？',opts:['規則的な構造','不規則な構造','液体'],ans:0},
      {q:'状態変化で質量は？',opts:['変わる','変わらない','増える'],ans:1},
      {q:'蒸留の原理は？',opts:['沸点の違い','密度の違い','溶解度の違い'],ans:0},
      {q:'ろ過の原理は？',opts:['粒子の大きさ','密度の違い','溶解度の違い'],ans:0},
      {q:'再結晶の原理は？',opts:['溶解度の温度変化','密度の違い','沸点の違い'],ans:0}
    ],
    advanced: [
      {q:'周期表で同じ族の元素の特徴は？',opts:['質量数が同じ','電子配置が似ている','密度が同じ'],ans:1},
      {q:'イオン結合の特徴は？',opts:['電子の共有','電子の移動','電子の変化なし'],ans:1},
      {q:'共有結合の特徴は？',opts:['電子の共有','電子の移動','電子の変化なし'],ans:0},
      {q:'金属結合の特徴は？',opts:['自由電子','固定電子','イオン'],ans:0},
      {q:'酸化数の変化がある反応は？',opts:['中和反応','酸化還元反応','沈殿反応'],ans:1},
      {q:'電池の負極では？',opts:['酸化','還元','中和'],ans:0},
      {q:'電池の正極では？',opts:['酸化','還元','中和'],ans:1},
      {q:'電気分解の陽極では？',opts:['酸化','還元','中和'],ans:0},
      {q:'電気分解の陰極では？',opts:['酸化','還元','中和'],ans:1},
      {q:'化学平衡とは？',opts:['反応が完全停止','正逆反応の速度が等しい','一方向の反応'],ans:1},
      {q:'ルシャトリエの原理とは？',opts:['平衡の移動','反応の停止','反応の開始'],ans:0},
      {q:'触媒は平衡に？',opts:['影響する','影響しない','時々影響する'],ans:1},
      {q:'濃度を上げると平衡は？',opts:['濃度を下げる方向','濃度を上げる方向','変化しない'],ans:0},
      {q:'温度を上げると吸熱反応の平衡は？',opts:['右に移動','左に移動','変化しない'],ans:0},
      {q:'圧力を上げると平衡は？',opts:['分子数の多い方','分子数の少ない方','変化しない'],ans:1},
      {q:'有機化合物の特徴は？',opts:['炭素を含む','酸素を含む','窒素を含む'],ans:0},
      {q:'メタンの分子式は？',opts:['CH4','C2H6','C3H8'],ans:0},
      {q:'エタンの分子式は？',opts:['CH4','C2H6','C3H8'],ans:1},
      {q:'プロパンの分子式は？',opts:['CH4','C2H6','C3H8'],ans:2},
      {q:'アルコールの官能基は？',opts:['－OH','－COOH','－CHO'],ans:0}
    ]
  },
  earth: {
    basic: [
      {q:'地球の内部構造で最も外側は？',opts:['地殻','マントル','核'],ans:0},
      {q:'地球の内部構造で最も内側は？',opts:['地殻','マントル','核'],ans:2},
      {q:'マグマが冷えて固まった岩石は？',opts:['火成岩','堆積岩','変成岩'],ans:0},
      {q:'砂や泥が積もって固まった岩石は？',opts:['火成岩','堆積岩','変成岩'],ans:1},
      {q:'熱や圧力で変化した岩石は？',opts:['火成岩','堆積岩','変成岩'],ans:2},
      {q:'地震の震源に最も近い地表の点は？',opts:['震央','震源','震度'],ans:0},
      {q:'地震の揺れの大きさを表すのは？',opts:['震央','震源','震度'],ans:2},
      {q:'地震の規模を表すのは？',opts:['震度','マグニチュード','震央'],ans:1},
      {q:'火山の噴火でできる岩石は？',opts:['火山岩','深成岩','堆積岩'],ans:0},
      {q:'地下深くでゆっくり冷えた岩石は？',opts:['火山岩','深成岩','堆積岩'],ans:1},
      {q:'化石が見つかりやすい岩石は？',opts:['火成岩','堆積岩','変成岩'],ans:1},
      {q:'地層の上下関係の原理は？',opts:['新しいものが下','古いものが下','順序は不明'],ans:1},
      {q:'断層とは何？',opts:['地層の境界','岩石の割れ目','火山の噴火口'],ans:1},
      {q:'褶曲とは何？',opts:['地層の曲がり','岩石の割れ目','火山の噴火'],ans:0},
      {q:'風化とは何？',opts:['岩石の破壊','岩石の移動','岩石の堆積'],ans:0},
      {q:'侵食とは何？',opts:['岩石の破壊','岩石の移動','岩石の堆積'],ans:1},
      {q:'堆積とは何？',opts:['岩石の破壊','岩石の移動','岩石の堆積'],ans:2},
      {q:'大気の主成分は？',opts:['酸素','窒素','二酸化炭素'],ans:1},
      {q:'酸素の大気中の割合は約？',opts:['21%','78%','1%'],ans:0},
      {q:'窒素の大気中の割合は約？',opts:['21%','78%','1%'],ans:1}
    ],
    applied: [
      {q:'プレートテクトニクス理論とは？',opts:['大陸移動説','海洋底拡大説','プレート運動説'],ans:2},
      {q:'プレートの境界で起こることは？',opts:['地震・火山活動','風化・侵食','堆積'],ans:0},
      {q:'海嶺で起こることは？',opts:['プレートの衝突','プレートの生成','プレートの消滅'],ans:1},
      {q:'海溝で起こることは？',opts:['プレートの衝突','プレートの生成','プレートの消滅'],ans:2},
      {q:'変成作用の要因は？',opts:['熱と圧力','水と風','重力'],ans:0},
      {q:'マグマの粘性が高いと？',opts:['爆発的噴火','静かな噴火','噴火しない'],ans:0},
      {q:'マグマの粘性が低いと？',opts:['爆発的噴火','静かな噴火','噴火しない'],ans:1},
      {q:'P波の特徴は？',opts:['横波','縦波','表面波'],ans:1},
      {q:'S波の特徴は？',opts:['横波','縦波','表面波'],ans:0},
      {q:'P波とS波の到達時間差から分かるのは？',opts:['震央距離','震度','マグニチュード'],ans:0},
      {q:'示相化石とは？',opts:['時代を示す','環境を示す','進化を示す'],ans:1},
      {q:'示準化石とは？',opts:['時代を示す','環境を示す','進化を示す'],ans:0},
      {q:'地質年代の区分で最も大きいのは？',opts:['代','紀','世'],ans:0},
      {q:'現在は何代？',opts:['古生代','中生代','新生代'],ans:2},
      {q:'恐竜が栄えた時代は？',opts:['古生代','中生代','新生代'],ans:1},
      {q:'気圧とは何？',opts:['空気の重さ','空気の温度','空気の湿度'],ans:0},
      {q:'高気圧の天気は？',opts:['晴れ','雨','雪'],ans:0},
      {q:'低気圧の天気は？',opts:['晴れ','雨','雪'],ans:1},
      {q:'前線とは何？',opts:['気団の境界','雲の境界','雨の境界'],ans:0},
      {q:'温暖前線の雲は？',opts:['積雲','層雲','乱雲'],ans:1}
    ],
    advanced: [
      {q:'マントル対流の原動力は？',opts:['重力','熱','磁力'],ans:1},
      {q:'大陸移動の証拠として最も重要なのは？',opts:['化石の分布','岩石の年代','古地磁気'],ans:2},
```javascript
      {q:'海洋底拡大の証拠は？',opts:['海底の年代分布','海底地形','海水温度'],ans:0},
      {q:'ホットスポットとは？',opts:['プレート境界','マントル上昇流','海底火山'],ans:1},
      {q:'変成度が最も高いのは？',opts:['粘板岩','片岩','片麻岩'],ans:2},
      {q:'接触変成作用の原因は？',opts:['マグマの熱','地殻変動','深部の圧力'],ans:0},
      {q:'広域変成作用の原因は？',opts:['マグマの熱','地殻変動','局所的圧力'],ans:1},
      {q:'火山岩の組織の特徴は？',opts:['粗粒','細粒','ガラス質'],ans:1},
      {q:'深成岩の組織の特徴は？',opts:['粗粒','細粒','ガラス質'],ans:0},
      {q:'地震波の屈折から分かるのは？',opts:['地球内部構造','震源の深さ','マグニチュード'],ans:0},
      {q:'地震波の影の領域ができる原因は？',opts:['地球の自転','核の存在','マントルの対流'],ans:1},
      {q:'古地磁気の逆転記録から分かるのは？',opts:['地球磁場の変化','プレート運動','気候変動'],ans:0},
      {q:'放射年代測定の原理は？',opts:['放射性崩壊','化学反応','物理変化'],ans:0},
      {q:'半減期とは？',opts:['元素が半分になる時間','反応が半分進む時間','温度が半分になる時間'],ans:0},
      {q:'絶対年代の測定に使うのは？',opts:['示準化石','放射性元素','示相化石'],ans:1},
      {q:'相対年代の決定に使うのは？',opts:['放射性元素','化石','鉱物'],ans:1},
      {q:'コリオリ力の原因は？',opts:['地球の自転','地球の公転','太陽の引力'],ans:0},
      {q:'偏西風の原因は？',opts:['気圧差','コリオリ力','両方'],ans:2},
      {q:'貿易風の原因は？',opts:['気圧差','コリオリ力','両方'],ans:2},
      {q:'海陸風の原因は？',opts:['比熱の違い','密度の違い','温度の違い'],ans:0},
      {q:'フェーン現象の原因は？',opts:['断熱変化','放射冷却','対流'],ans:0},
      {q:'雲ができる条件は？',opts:['飽和水蒸気量に達する','温度上昇','気圧上昇'],ans:0}
    ]
  },
  biology: {
    basic: [
      {q:'植物の細胞にあって動物の細胞にないのは？',opts:['細胞膜','細胞壁','細胞質'],ans:1},
      {q:'細胞の中で呼吸を行う場所は？',opts:['核','ミトコンドリア','葉緑体'],ans:1},
      {q:'植物が光合成を行う場所は？',opts:['核','ミトコンドリア','葉緑体'],ans:2},
      {q:'光合成で作られる物質は？',opts:['デンプン','タンパク質','脂肪'],ans:0},
      {q:'光合成に必要な気体は？',opts:['酸素','二酸化炭素','窒素'],ans:1},
      {q:'光合成で発生する気体は？',opts:['酸素','二酸化炭素','窒素'],ans:0},
      {q:'呼吸で消費される気体は？',opts:['酸素','二酸化炭素','窒素'],ans:0},
      {q:'呼吸で発生する気体は？',opts:['酸素','二酸化炭素','窒素'],ans:1},
      {q:'植物の根から吸収されるのは？',opts:['水と養分','酸素','二酸化炭素'],ans:0},
      {q:'植物の葉から出入りする気体の通り道は？',opts:['気孔','維管束','表皮'],ans:0},
      {q:'植物の水や養分の通り道は？',opts:['気孔','維管束','表皮'],ans:1},
      {q:'動物の消化器官で最初に食物が入るのは？',opts:['胃','口','食道'],ans:1},
      {q:'動物の消化器官で消化液が最も多く分泌されるのは？',opts:['胃','小腸','大腸'],ans:1},
      {q:'動物の消化器官で栄養分が最も多く吸収されるのは？',opts:['胃','小腸','大腸'],ans:1},
      {q:'動物の循環器官で血液を送り出すのは？',opts:['心臓','血管','肺'],ans:0},
      {q:'動物の呼吸器官でガス交換を行うのは？',opts:['気管','気管支','肺胞'],ans:2},
      {q:'動物の排出器官で尿を作るのは？',opts:['肝臓','腎臓','膀胱'],ans:1},
      {q:'動物の感覚器官で光を感じるのは？',opts:['目','耳','鼻'],ans:0},
      {q:'動物の感覚器官で音を感じるのは？',opts:['目','耳','鼻'],ans:1},
      {q:'動物の感覚器官でにおいを感じるのは？',opts:['目','耳','鼻'],ans:2}
    ],
    applied: [
      {q:'単細胞生物の例は？',opts:['ミドリムシ','ミミズ','メダカ'],ans:0},
      {q:'多細胞生物の例は？',opts:['アメーバ','ゾウリムシ','ヒドラ'],ans:2},
      {q:'細胞分裂で染色体数は？',opts:['半分になる','同じ','倍になる'],ans:1},
      {q:'生殖細胞の染色体数は？',opts:['体細胞と同じ','体細胞の半分','体細胞の倍'],ans:1},
      {q:'受精卵の染色体数は？',opts:['生殖細胞と同じ','生殖細胞の倍','生殖細胞の半分'],ans:1},
      {q:'無性生殖の特徴は？',opts:['遺伝的多様性','親と同じ遺伝子','新しい形質'],ans:1},
      {q:'有性生殖の特徴は？',opts:['親と同じ遺伝子','遺伝的多様性','分裂のみ'],ans:1},
      {q:'メンデルの法則で優性の法則とは？',opts:['優性形質のみ現れる','劣性形質のみ現れる','両方現れる'],ans:0},
      {q:'メンデルの法則で分離の法則とは？',opts:['形質が混合','形質が分離','形質が消失'],ans:1},
      {q:'遺伝子の本体は？',opts:['タンパク質','DNA','RNA'],ans:1},
      {q:'DNAの構造は？',opts:['一重らせん','二重らせん','三重らせん'],ans:1},
      {q:'タンパク質を合成する場所は？',opts:['核','リボソーム','ミトコンドリア'],ans:1},
      {q:'進化の証拠として重要なのは？',opts:['化石','相同器官','両方'],ans:2},
      {q:'自然選択の要因は？',opts:['環境への適応','突然変異','遺伝'],ans:0},
      {q:'生物の分類で最も大きな単位は？',opts:['界','門','綱'],ans:0},
      {q:'生物の学名は何語？',opts:['英語','ラテン語','ギリシャ語'],ans:1},
      {q:'生態系の生産者は？',opts:['植物','動物','細菌'],ans:0},
      {q:'生態系の消費者は？',opts:['植物','動物','分解者'],ans:1},
      {q:'生態系の分解者は？',opts:['植物','動物','細菌・菌類'],ans:2},
      {q:'食物連鎖で上位ほど？',opts:['個体数が多い','個体数が少ない','変わらない'],ans:1}
    ],
    advanced: [
      {q:'酵素の働きに必要な条件は？',opts:['高温','適温','低温'],ans:1},
      {q:'酵素の基質特異性とは？',opts:['特定の基質にのみ働く','すべての基質に働く','基質を選ばない'],ans:0},
      {q:'光合成の光反応で起こることは？',opts:['CO2の固定','水の分解','糖の合成'],ans:1},
      {q:'光合成の暗反応で起こることは？',opts:['水の分解','CO2の固定','酸素の発生'],ans:1},
      {q:'呼吸の解糖系で起こることは？',opts:['グルコースの分解','酸素の消費','水の生成'],ans:0},
      {q:'呼吸のクエン酸回路で起こることは？',opts:['グルコースの分解','アセチルCoAの分解','酸素の消費'],ans:1},
      {q:'細胞膜の構造は？',opts:['単分子膜','二分子膜','三分子膜'],ans:1},
      {q:'能動輸送に必要なのは？',opts:['ATP','濃度勾配','両方'],ans:0},
      {q:'受動輸送の原理は？',opts:['ATP','濃度勾配','ポンプ'],ans:1},
      {q:'体細胞分裂の意義は？',opts:['成長・修復','生殖','進化'],ans:0},
      {q:'減数分裂の意義は？',opts:['成長','生殖','修復'],ans:1},
      {q:'遺伝子の転写で作られるのは？',opts:['DNA','RNA','タンパク質'],ans:1},
      {q:'遺伝子の翻訳で作られるのは？',opts:['DNA','RNA','タンパク質'],ans:2},
      {q:'突然変異の原因は？',opts:['環境要因','複製エラー','両方'],ans:2},
      {q:'適応放散とは？',opts:['一種から多種への分化','多種から一種への収束','種の絶滅'],ans:0},
      {q:'収斂進化とは？',opts:['異なる系統の類似','同じ系統の分化','進化の停止'],ans:0},
      {q:'共進化とは？',opts:['独立した進化','相互に影響する進化','同時期の進化'],ans:1},
      {q:'生物多様性の意義は？',opts:['生態系の安定','進化の材料','両方'],ans:2},
      {q:'絶滅の主な原因は？',opts:['自然災害','人間活動','気候変動'],ans:1},
      {q:'保全生物学の目的は？',opts:['生物多様性の保護','経済的利益','科学的研究'],ans:0}
    ]
  },
  physics: {
    basic: [
      {q:'物体の重さを表すのは？',opts:['質量','重量','密度'],ans:1},
      {q:'物体の量を表すのは？',opts:['質量','重量','密度'],ans:0},
      {q:'速度の単位は？',opts:['m','m/s','m/s²'],ans:1},
      {q:'加速度の単位は？',opts:['m','m/s','m/s²'],ans:2},
      {q:'力の単位は？',opts:['N','J','W'],ans:0},
      {q:'仕事の単位は？',opts:['N','J','W'],ans:1},
      {q:'電力の単位は？',opts:['N','J','W'],ans:2},
      {q:'物体が静止している時の運動は？',opts:['等速直線運動','等加速度運動','静止'],ans:2},
      {q:'物体が一定の速度で動く運動は？',opts:['等速直線運動','等加速度運動','静止'],ans:0},
      {q:'物体の速度が一定に変化する運動は？',opts:['等速直線運動','等加速度運動','円運動'],ans:1},
      {q:'重力加速度の大きさは約？',opts:['9.8m/s²','10m/s²','両方正しい'],ans:2},
      {q:'物体を上に投げた時の最高点での速度は？',opts:['0','最大','最小'],ans:0},
      {q:'物体を水平に投げた時の軌道は？',opts:['直線','放物線','円'],ans:1},
      {q:'慣性とは？',opts:['運動を続けようとする性質','静止を続けようとする性質','両方'],ans:2},
      {q:'作用・反作用の法則で力の大きさは？',opts:['等しい','異なる','場合による'],ans:0},
      {q:'摩擦力の向きは？',opts:['運動方向と同じ','運動方向と逆','垂直'],ans:1},
      {q:'浮力の大きさは？',opts:['物体の重さ','押しのけた液体の重さ','液体の重さ'],ans:1},
      {q:'圧力の単位は？',opts:['Pa','N','J'],ans:0},
      {q:'大気圧の大きさは約？',opts:['1013hPa','760hPa','両方正しい'],ans:2},
      {q:'音の速さは約？',opts:['340m/s','3×10⁸m/s','299792458m/s'],ans:0}
    ],
    applied: [
      {q:'等速直線運動の加速度は？',opts:['0','一定','変化する'],ans:0},
      {q:'自由落下運動の初速度は？',opts:['0','一定','重力加速度'],ans:0},
      {q:'鉛直投射の最高点での加速度は？',opts:['0','重力加速度','最大'],ans:1},
      {q:'水平投射の水平方向の運動は？',opts:['等速直線運動','等加速度運動','円運動'],ans:0},
      {q:'水平投射の鉛直方向の運動は？',opts:['等速直線運動','自由落下運動','等加速度運動'],ans:1},
      {q:'円運動の向心力の向きは？',opts:['円の接線方向','円の中心方向','円の外方向'],ans:1},
      {q:'慣性の法則は運動の第何法則？',opts:['第1法則','第2法則','第3法則'],ans:0},
      {q:'運動方程式は運動の第何法則？',opts:['第1法則','第2法則','第3法則'],ans:1},
      {q:'作用・反作用の法則は運動の第何法則？',opts:['第1法則','第2法則','第3法則'],ans:2},
      {q:'運動量の単位は？',opts:['kg・m/s','N・s','両方正しい'],ans:2},
      {q:'力積の単位は？',opts:['kg・m/s','N・s','両方正しい'],ans:2},
      {q:'運動量保存の法則が成り立つ条件は？',opts:['外力がない','摩擦がない','空気抵抗がない'],ans:0},
      {q:'仕事の定義は？',opts:['力×距離','力×時間','力×速度'],ans:0},
      {q:'仕事率の定義は？',opts:['仕事÷時間','仕事×時間','仕事÷距離'],ans:0},
      {q:'位置エネルギーの基準点は？',opts:['決まっている','任意に決める','地面'],ans:1},
      {q:'運動エネルギーの式は？',opts:['½mv²','mv²','2mv²'],ans:0},
      {q:'位置エネルギーの式は？',opts:['mgh','½mgh','2mgh'],ans:0},
      {q:'力学的エネルギー保存の条件は？',opts:['摩擦がない','空気抵抗がない','両方'],ans:2},
      {q:'波の基本的性質は？',opts:['反射・屈折','干渉・回折','すべて'],ans:2},
      {q:'縦波の例は？',opts:['音波','光波','水面波'],ans:0}
    ],
    advanced: [
      {q:'等加速度直線運動の速度の式は？',opts:['v=v₀+at','v=v₀t+½at²','x=v₀t+½at²'],ans:0},
      {q:'等加速度直線運動の変位の式は？',opts:['v=v₀+at','v=v₀t+½at²','x=v₀t+½at²'],ans:2},
      {q:'斜方投射の最大飛距離の角度は？',opts:['30°','45°','60°'],ans:1},
      {q:'単振動の復元力は？',opts:['変位に比例','速度に比例','加速度に比例'],ans:0},
      {q:'単振動の周期は振幅に？',opts:['比例','反比例','無関係'],ans:2},
      {q:'万有引力の法則の式は？',opts:['F=Gm₁m₂/r²','F=Gm₁m₂r²','F=Gm₁m₂/r'],ans:0},
      {q:'第一宇宙速度は約？',opts:['7.9km/s','11.2km/s','16.7km/s'],ans:0},
      {q:'第二宇宙速度は約？',opts:['7.9km/s','11.2km/s','16.7km/s'],ans:1},
      {q:'運動量と力積の関係は？',opts:['運動量の変化=力積','運動量=力積','運動量×力積=一定'],ans:0},
      {q:'弾性衝突で保存されるのは？',opts:['運動量のみ','運動エネルギーのみ','両方'],ans:2},
      {q:'非弾性衝突で保存されるのは？',opts:['運動量のみ','運動エネルギーのみ','両方'],ans:0},
      {q:'剛体の回転運動で角速度の単位は？',opts:['rad/s','m/s','Hz'],ans:0},
      {q:'慣性モーメントは何に依存する？',opts:['質量のみ','形状のみ','質量と形状'],ans:2},
      {q:'角運動量保存の法則が成り立つ条件は？',opts:['外力がない','外力のモーメントがない','摩擦がない'],ans:1},
      {q:'波の干渉で強め合う条件は？',opts:['経路差=nλ','経路差=(n+½)λ','位相差=π'],ans:0},
      {q:'波の干渉で弱め合う条件は？',opts:['経路差=nλ','経路差=(n+½)λ','位相差=0'],ans:1},
      {q:'ドップラー効果で音源が近づくと？',opts:['振動数増加','振動数減少','変化なし'],ans:0},
      {q:'ドップラー効果で音源が遠ざかると？',opts:['振動数増加','振動数減少','変化なし'],ans:1},
      {q:'光の速さは約？',opts:['3×10⁸m/s','3×10⁶m/s','3×10¹⁰m/s'],ans:0},
      {q:'屈折の法則（スネルの法則）は？',opts:['n₁sinθ₁=n₂sinθ₂','n₁cosθ₁=n₂cosθ₂','n₁tanθ₁=n₂tanθ₂'],ans:0}
    ]
  },
  english_words: {
    basic: [
      {q:'「学校」を英語で？',opts:['school','house','office'],ans:0},
      {q:'「家」を英語で？',opts:['school','house','office'],ans:1},
      {q:'「本」を英語で？',opts:['book','pen','pencil'],ans:0},
      {q:'「ペン」を英語で？',opts:['book','pen','pencil'],ans:1},
      {q:'「車」を英語で？',opts:['car','bus','train'],ans:0},
      {q:'「犬」を英語で？',opts:['cat','dog','bird'],ans:1},
      {q:'「猫」を英語で？',opts:['cat','dog','bird'],ans:0},
      {q:'「赤い」を英語で？',opts:['red','blue','green'],ans:0},
      {q:'「青い」を英語で？',opts:['red','blue','green'],ans:1},
      {q:'「大きい」を英語で？',opts:['big','small','tall'],ans:0},
      {q:'「小さい」を英語で？',opts:['big','small','tall'],ans:1},
      {q:'「食べる」を英語で？',opts:['eat','drink','sleep'],ans:0},
      {q:'「飲む」を英語で？',opts:['eat','drink','sleep'],ans:1},
      {q:'「走る」を英語で？',opts:['walk','run','jump'],ans:1},
      {q:'「歩く」を英語で？',opts:['walk','run','jump'],ans:0},
      {q:'「見る」を英語で？',opts:['see','hear','smell'],ans:0},
      {q:'「聞く」を英語で？',opts:['see','hear','smell'],ans:1},
      {q:'「話す」を英語で？',opts:['speak','listen','write'],ans:0},
      {q:'「書く」を英語で？',opts:['speak','listen','write'],ans:2},
      {q:'「読む」を英語で？',opts:['read','write','listen'],ans:0}
    ],
    applied: [
      {q:'「環境」を英語で？',opts:['environment','government','development'],ans:0},
      {q:'「政府」を英語で？',opts:['environment','government','development'],ans:1},
      {q:'「発展」を英語で？',opts:['environment','government','development'],ans:2},
      {q:'「重要な」を英語で？',opts:['important','interesting','difficult'],ans:0},
      {q:'「興味深い」を英語で？',opts:['important','interesting','difficult'],ans:1},
      {q:'「困難な」を英語で？',opts:['important','interesting','difficult'],ans:2},
      {q:'「成功」を英語で？',opts:['success','failure','progress'],ans:0},
      {q:'「失敗」を英語で？',opts:['success','failure','progress'],ans:1},
      {q:'「進歩」を英語で？',opts:['success','failure','progress'],ans:2},
      {q:'「経験」を英語で？',opts:['experience','experiment','explanation'],ans:0},
      {q:'「実験」を英語で？',opts:['experience','experiment','explanation'],ans:1},
      {q:'「説明」を英語で？',opts:['experience','experiment','explanation'],ans:2},
      {q:'「決定する」を英語で？',opts:['decide','include','exclude'],ans:0},
      {q:'「含む」を英語で？',opts:['decide','include','exclude'],ans:1},
      {q:'「除外する」を英語で？',opts:['decide','include','exclude'],ans:2},
      {q:'「提案する」を英語で？',opts:['suggest','request','require'],ans:0},
      {q:'「要求する」を英語で？',opts:['suggest','request','require'],ans:1},
      {q:'「必要とする」を英語で？',opts:['suggest','request','require'],ans:2},
      {q:'「比較する」を英語で？',opts:['compare','contrast','compete'],ans:0},
      {q:'「競争する」を英語で？',opts:['compare','contrast','compete'],ans:2}
    ],
    advanced: [
      {q:'「獲得する」を英語で？',opts:['acquire','require','inquire'],ans:0},
      {q:'「調査する」を英語で？',opts:['acquire','require','inquire'],ans:2},
      {q:'「維持する」を英語で？',opts:['maintain','contain','obtain'],ans:0},
      {q:'「含有する」を英語で？',opts:['maintain','contain','obtain'],ans:1},
      {q:'「得る」を英語で？',opts:['maintain','contain','obtain'],ans:2},
      {q:'「評価する」を英語で？',opts:['evaluate','calculate','estimate'],ans:0},
      {q:'「計算する」を英語で？',opts:['evaluate','calculate','estimate'],ans:1},
      {q:'「推定する」を英語で？',opts:['evaluate','calculate','estimate'],ans:2},
      {q:'「分析する」を英語で？',opts:['analyze','synthesize','criticize'],ans:0},
      {q:'「合成する」を英語で？',opts:['analyze','synthesize','criticize'],ans:1},
      {q:'「批判する」を英語で？',opts:['analyze','synthesize','criticize'],ans:2},
      {q:'「仮定する」を英語で？',opts:['assume','presume','consume'],ans:0},
      {q:'「推定する」を英語で？',opts:['assume','presume','consume'],ans:1},
      {q:'「消費する」を英語で？',opts:['assume','presume','consume'],ans:2},
      {q:'「影響を与える」を英語で？',opts:['affect','effect','defect'],ans:0},
      {q:'「効果」を英語で？',opts:['affect','effect','defect'],ans:1},
      {q:'「欠陥」を英語で？',opts:['affect','effect','defect'],ans:2},
      {q:'「明確な」を英語で？',opts:['apparent','transparent','coherent'],ans:0},
      {q:'「透明な」を英語で？',opts:['apparent','transparent','coherent'],ans:1},
      {q:'「一貫した」を英語で？',opts:['apparent','transparent','coherent'],ans:2}
    ]
  },
  english_phrases: {
    basic: [
      {q:'「take care」の意味は？',opts:['気をつけて','持っていく','世話をする'],ans:0},
      {q:'「look for」の意味は？',opts:['見る','探す','見つける'],ans:1},
      {q:'「look after」の意味は？',opts:['後で見る','世話をする','見送る'],ans:1},
      {q:'「get up」の意味は？',opts:['起きる','上がる','取る'],ans:0},
      {q:'「get on」の意味は？',opts:['降りる','乗る','進む'],ans:1},
      {q:'「put on」の意味は？',opts:['置く','着る','消す'],ans:1},
      {q:'「take off」の意味は？',opts:['脱ぐ','持っていく','離陸する'],ans:0},
      {q:'「turn on」の意味は？',opts:['回る','つける','向く'],ans:1},
      {q:'「turn off」の意味は？',opts:['回る','消す','向く'],ans:1},
      {q:'「give up」の意味は？',opts:['与える','あきらめる','上げる'],ans:1},
      {q:'「pick up」の意味は？',opts:['選ぶ','拾う','迎えに行く'],ans:1},
      {q:'「come back」の意味は？',opts:['来る','戻る','後ろに来る'],ans:1},
      {q:'「go out」の意味は？',opts:['行く','外出する','出かける'],ans:1},
      {q:'「sit down」の意味は？',opts:['座る','下に座る','落ち着く'],ans:0},
      {q:'「stand up」の意味は？',opts:['立つ','立ち上がる','我慢する'],ans:1},
      {q:'「wake up」の意味は？',opts:['歩く','目を覚ます','起こす'],ans:1},
      {q:'「hurry up」の意味は？',opts:['急ぐ','上に急ぐ','心配する'],ans:0},
      {q:'「clean up」の意味は？',opts:['きれいな','片付ける','掃除する'],ans:1},
      {q:'「grow up」の意味は？',opts:['成長する','大人になる','育てる'],ans:1},
      {q:'「find out」の意味は？',opts:['見つける','見つけ出す','調べる'],ans:2}
    ],
    applied: [
      {q:'「run out of」の意味は？',opts:['走って出る','不足する','逃げ出す'],ans:1},
      {q:'「get along with」の意味は？',opts:['一緒に行く','仲良くする','進歩する'],ans:1},
      {q:'「look forward to」の意味は？',opts:['前を見る','楽しみにする','将来を見る'],ans:1},
      {q:'「take part in」の意味は？',opts:['部分を取る','参加する','分ける'],ans:1},
      {q:'「make up」の意味は？',opts:['作る','化粧する','仲直りする'],ans:2},
      {q:'「break down」の意味は？',opts:['壊す','故障する','分解する'],ans:1},
      {q:'「bring up」の意味は？',opts:['持ってくる','育てる','話題にする'],ans:1},
      {q:'「carry out」の意味は？',opts:['運ぶ','実行する','外に運ぶ'],ans:1},
      {q:'「come across」の意味は？',opts:['横切る','偶然出会う','やってくる'],ans:1},
      {q:'「cut down」の意味は？',opts:['切る','削減する','伐採する'],ans:1},
      {q:'「deal with」の意味は？',opts:['取引する','対処する','扱う'],ans:1},
      {q:'「depend on」の意味は？',opts:['下がる','依存する','頼る'],ans:2},
      {q:'「figure out」の意味は？',opts:['計算する','理解する','解決する'],ans:2},
      {q:'「give in」の意味は？',opts:['与える','屈服する','入れる'],ans:1},
      {q:'「hand in」の意味は？',opts:['手を入れる','提出する','手渡す'],ans:1},
      {q:'「keep up」の意味は？',opts:['保つ','続ける','維持する'],ans:1},
      {q:'「let down」の意味は？',opts:['下ろす','がっかりさせる','失望させる'],ans:2},
      {q:'「pass away」の意味は？',opts:['通り過ぎる','亡くなる','去る'],ans:1},
      {q:'「put off」の意味は？',opts:['置く','延期する','脱ぐ'],ans:1},
      {q:'「set up」の意味は？',opts:['置く','設立する','準備する'],ans:1}
    ],
    advanced: [
      {q:'「account for」の意味は？',opts:['説明する','計算する','責任を持つ'],ans:0},
      {q:'「back down」の意味は？',opts:['後退する','引き下がる','支援する'],ans:1},
      {q:'「call off」の意味は？',opts:['呼ぶ','中止する','電話する'],ans:1},
      {q:'「come up with」の意味は？',opts:['上がってくる','思いつく','追いつく'],ans:1},
      {q:'「do away with」の意味は？',opts:['離れる','廃止する','片付ける'],ans:1},
      {q:'「fall behind」の意味は？',opts:['後ろに落ちる','遅れる','失敗する'],ans:1},
      {q:'「get over」の意味は？',opts:['越える','回復する','乗り越える'],ans:2},
      {q:'「hold up」の意味は？',opts:['持ち上げる','遅らせる','強盗する'],ans:1},
      {q:'「live up to」の意味は？',opts:['住む','期待に応える','生き抜く'],ans:1},
      {q:'「make up for」の意味は？',opts:['構成する','補償する','化粧する'],ans:1},
      {q:'「put up with」の意味は？',opts:['建てる','我慢する','泊める'],ans:1},
      {q:'「run into」の意味は？',opts:['走る','偶然出会う','衝突する'],ans:1},
      {q:'「see through」の意味は？',opts:['透けて見る','見抜く','最後まで見る'],ans:1},
      {q:'「take over」の意味は？',opts:['取る','引き継ぐ','乗っ取る'],ans:1},
      {q:'「turn down」の意味は？',opts:['下を向く','断る','音量を下げる'],ans:1},
      {q:'「work out」の意味は？',opts:['外で働く','解決する','運動する'],ans:1},
      {q:'「bring about」の意味は？',opts:['持ってくる','引き起こす','もたらす'],ans:2},
      {q:'「catch up with」の意味は？',opts:['捕まえる','追いつく','理解する'],ans:1},
      {q:'「go through」の意味は？',opts:['通り抜ける','経験する','調べる'],ans:1},
      {q:'「look into」の意味は？',opts:['中を見る','調査する','検討する'],ans:2}
    ]
  }
};

/* ----------------- ゲーム変数 ----------------- */
let coins = 0;
let dps = 10;
let critRate = 5;
let defense = 0;
let enemyHPMax = 100;
let enemyHP = enemyHPMax;
let killCount = 0;
let quizTimer = 0;
let quizTimeLeft = 30;
let playerLevel = 1;
let playerExp = 0;
let playerExpMax = 100;
let currentSubject = '';
let currentQuizType = '';

// コスト管理
let attackCost = 100;
let critCost = 200;
let defenseCost = 150;

// 実績システム
const achievements = [
  { id: 'first_kill', name: '初撃破', desc: '最初の敵を倒す', condition: () => killCount >= 1, unlocked: false },
  { id: 'ten_kills', name: '連続撃破', desc: '10体の敵を倒す', condition: () => killCount >= 10, unlocked: false },
  { id: 'hundred_kills', name: '百体撃破', desc: '100体の敵を倒す', condition: () => killCount >= 100, unlocked: false },
  { id: 'rich', name: 'お金持ち', desc: '1000コイン貯める', condition: () => coins >= 1000, unlocked: false },
  { id: 'level_5', name: 'レベル5', desc: 'レベル5に到達', condition: () => playerLevel >= 5, unlocked: false },
  { id: 'level_10', name: 'レベル10', desc: 'レベル10に到達', condition: () => playerLevel >= 10, unlocked: false },
  { id: 'high_attack', name: '強力な攻撃', desc: '攻撃力100以上', condition: () => dps >= 100, unlocked: false },
  { id: 'crit_master', name: 'クリティカルマスター', desc: 'クリティカル率30%以上', condition: () => critRate >= 30, unlocked: false },
  { id: 'defender', name: '守りの達人', desc: '防御力50以上', condition: () => defense >= 50, unlocked: false },
  { id: 'quiz_master', name: 'クイズマスター', desc: 'クイズに50回正解', condition: () => (localStorage.getItem('quizCorrect') || 0) >= 50, unlocked: false }
];

// DOM要素
const enemyName = document.getElementById('enemyName');
const hpBar = document.getElementById('hpBar');
const statsDiv = document.getElementById('stats');
const expBar = document.getElementById('expBar');
const expText = document.getElementById('expText');
const achievementsDiv = document.getElementById('achievements');
const currentSubjectDiv = document.getElementById('currentSubject');

/* ----------------- エフェクト関数 ----------------- */
function createParticle(text, color, x, y) {
  const particle = document.createElement('div');
  particle.className = 'particle';
  particle.textContent = text;
  particle.style.color = color;
  particle.style.left = x + 'px';
  particle.style.top = y + 'px';
  particle.style.fontSize = '18px';
  document.body.appendChild(particle);
  
  setTimeout(() => {
    if (particle.parentNode) {
      particle.parentNode.removeChild(particle);
    }
  }, 2000);
}

function showNotification(text) {
  const notification = document.getElementById('notification');
  const notificationText = document.getElementById('notificationText');
  
  notificationText.textContent = text;
  notification.classList.add('show');
  
  setTimeout(() => {
    notification.classList.remove('show');
  }, 3000);
}

/* ----------------- レベルシステム ----------------- */
function gainExp(amount) {
  playerExp += amount;
  if (playerExp >= playerExpMax) {
    playerLevel++;
    playerExp = 0;
    playerExpMax = Math.floor(playerExpMax * 1.5);
    createParticle('LEVEL UP!', '#10b981', window.innerWidth / 2, window.innerHeight / 2);
    showNotification(`レベル${playerLevel}に上がりました！`);
    
    // レベルアップボーナス
    coins += playerLevel * 50;
    dps += playerLevel * 2;
  }
}

/* ----------------- 実績システム ----------------- */
function checkAchievements() {
  achievements.forEach(achievement => {
    if (!achievement.unlocked && achievement.condition()) {
      achievement.unlocked = true;
      showNotification(achievement.name + ': ' + achievement.desc);
      coins += 200; // 実績ボーナス
    }
  });
}

function renderAchievements() {
  achievementsDiv.innerHTML = '';
  achievements.forEach(achievement => {
    const div = document.createElement('div');
    div.className = `text-xs p-2 rounded ${achievement.unlocked ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-500'}`;
    div.innerHTML = `
      <div class="font-medium">${achievement.unlocked ? '🏆' : '🔒'} ${achievement.name}</div>
      <div class="text-xs opacity-75">${achievement.desc}</div>
    `;
    achievementsDiv.appendChild(div);
  });
}

/* ----------------- 画面更新 ----------------- */
function renderStats() {
  statsDiv.innerHTML = `
    <div><span class="font-medium">コイン:</span> <span class="font-bold text-yellow-600">${coins.toLocaleString()}</span></div>
    <div><span class="font-medium">攻撃力:</span> <span class="font-bold text-red-600">${dps}/秒</span></div>
    <div><span class="font-medium">クリティカル率:</span> <span class="font-bold text-yellow-600">${critRate}%</span></div>
    <div><span class="font-medium">防御力:</span> <span class="font-bold text-blue-600">${defense}</span></div>
    <div><span class="font-medium">レベル:</span> <span class="font-bold text-purple-600">${playerLevel}</span></div>
    <div><span class="font-medium">撃破数:</span> <span class="font-bold text-gray-600">${killCount}</span></div>
  `;
  
  // 経験値バー
  const expPercent = (playerExp / playerExpMax) * 100;
  expBar.style.width = expPercent + '%';
  expText.textContent = `${playerExp}/${playerExpMax}`;
  
  // コスト更新
  document.getElementById('attackCost').textContent = attackCost;
  document.getElementById('critCost').textContent = critCost;
  document.getElementById('defenseCost').textContent = defenseCost;
  
  // ボタンの有効/無効
  document.getElementById('upgradeAttack').disabled = coins < attackCost;
  document.getElementById('upgradeCrit').disabled = coins < critCost;
  document.getElementById('upgradeDefense').disabled = coins < defenseCost;
}

function renderEnemy() {
  const subjectNames = {
    'history': '歴史モンスター',
    'geography': '地理モンスター', 
    'civics': '公民モンスター',
    'chemistry': '化学モンスター',
    'earth': '地学モンスター',
    'biology': '生物モンスター',
    'physics': '物理モンスター',
    'english_words': '英単語モンスター',
    'english_phrases': '英熟語モンスター'
  };
  
  const currentEnemyType = subjectNames[currentSubject] || 'テストモンスター';
  enemyName.textContent = `${currentEnemyType} Lv.${Math.floor(killCount / 5) + 1}`;
  
  const hpPercent = (enemyHP / enemyHPMax) * 100;
  hpBar.style.width = hpPercent + '%';
  
  // HPバーの色変更
  if (hpPercent > 60) {
    hpBar.style.background = 'linear-gradient(90deg, #10b981, #059669)';
  } else if (hpPercent > 30) {
    hpBar.style.background = 'linear-gradient(90deg, #f59e0b, #d97706)';
  } else {
    hpBar.style.background = 'linear-gradient(90deg, #ef4444, #dc2626)';
  }
  
  document.getElementById('enemyStats').textContent = `HP: ${enemyHP}/${enemyHPMax}`;
}

/* ----------------- 教科選択（緊急修正版） ----------------- */
function initSubjectSelection() {
  console.log('教科選択初期化開始');
  
  // 少し待ってからボタンを取得
  setTimeout(() => {
    const subjectButtons = document.querySelectorAll('.subject-btn');
    const startButton = document.getElementById('startGame');
    let selectedSubject = '';
    
    console.log('見つかったボタン数:', subjectButtons.length);
    
    if (subjectButtons.length === 0) {
      console.error('教科選択ボタンが見つかりません');
      return;
    }
    
    // 初期状態
    startButton.disabled = true;
    
    // 各ボタンにイベントを設定
    subjectButtons.forEach((btn, index) => {
      console.log(`ボタン${index}:`, btn.getAttribute('data-subject'));
      
      // クリックイベント
      btn.onclick = function(e) {
        e.preventDefault();
        e.stopPropagation();
        
        console.log('ボタンがクリックされました:', this.getAttribute('data-subject'));
        
        // 全てのボタンからactiveクラスを削除
        subjectButtons.forEach(b => b.classList.remove('active'));
        
        // クリックされたボタンにactiveクラスを追加
        this.classList.add('active');
        
        // 選択された教科を取得
        selectedSubject = this.getAttribute('data-subject');
        
        // スタートボタンを有効化
        startButton.disabled = false;
        startButton.style.opacity = '1';
        
        console.log('選択された教科:', selectedSubject);
      };
      
      // タッチイベントも追加（スマホ対応）
      btn.addEventListener('touchend', function(e) {
        e.preventDefault();
        this.click();
      });
    });
    
    // スタートボタンのイベント
    startButton.onclick = function(e) {
      e.preventDefault();
      
      console.log('スタートボタンクリック:', selectedSubject);
      
      if (selectedSubject) {
        currentSubject = selectedSubject;
        document.getElementById('subjectModal').classList.remove('show');
        
        const subjectNameMap = {
          'history': '📚 歴史',
          'geography': '🗺️ 地理',
          'civics': '🏛️ 公民',
          'chemistry': '🧪 化学',
          'earth': '🌍 地学',
          'biology': '🧬 生物',
          'physics': '⚛️ 物理',
          'english_words': '📝 英単語',
          'english_phrases': '💬 英熟語'
        };
        
        currentSubjectDiv.textContent = subjectNameMap[currentSubject];
        startGameLoop();
        
        console.log('ゲーム開始:', currentSubject);
      } else {
        alert('教科を選択してください');
      }
    };
    
  }, 500);
}

/* ----------------- バトルループ ----------------- */
function startBattleLoop() {
  setInterval(() => {
    // クリティカル判定
    const isCrit = Math.random() * 100 < critRate;
    const damage = isCrit ? dps * 2 : dps;
    
    enemyHP -= damage;
    
    // ダメージ表示
    const enemyElement = document.getElementById('enemyInfo');
    const rect = enemyElement.getBoundingClientRect();
    createParticle(
      isCrit ? `CRIT! -${damage}` : `-${damage}`,
      isCrit ? '#f59e0b' : '#ef4444',
      rect.left + rect.width / 2,
      rect.top
    );
    
    if (isCrit) {
      enemyElement.classList.add('shake');
      setTimeout(() => enemyElement.classList.remove('shake'), 500);
    }
    
    if (enemyHP <= 0) {
      // 敵撃破
      const coinReward = 50 + Math.floor(killCount / 10) * 25;
      const expReward = 20 + Math.floor(killCount / 5) * 5;
      
      coins += coinReward;
      gainExp(expReward);
      killCount++;
      
      // 新しい敵生成
      enemyHPMax = Math.round(enemyHPMax * 1.15);
      enemyHP = enemyHPMax;
      
      // リワード表示
      createParticle(`+${coinReward} コイン`, '#f59e0b', window.innerWidth / 2 - 50, window.innerHeight / 2 + 50);
      createParticle(`+${expReward} EXP`, '#8b5cf6', window.innerWidth / 2 + 50, window.innerHeight / 2 + 50);
      
      // ボス戦判定
      if (killCount % 50 === 0) {
        enemyHPMax *= 3;
        enemyHP = enemyHPMax;
        showNotification('ボス出現！');
      }
    }
    
    // クイズタイマー
    if (++quizTimer >= 20) {
      quizTimer = 0;
      openQuiz();
    }
    
    checkAchievements();
    renderStats();
    renderEnemy();
    renderAchievements();
  }, 1000);
}

/* ----------------- 強化ボタン ----------------- */
function initUpgradeButtons() {
  document.getElementById('upgradeAttack').onclick = () => {
    if (coins >= attackCost) {
      coins -= attackCost;
      dps += 15;
      attackCost = Math.floor(attackCost * 1.5);
      currentQuizType = 'basic';
      createParticle('基礎力UP!', '#ef4444', window.innerWidth / 2, window.innerHeight / 3);
      renderStats();
    }
  };

  document.getElementById('upgradeCrit').onclick = () => {
    if (coins >= critCost) {
      coins -= critCost;
      critRate += 5;
      critCost = Math.floor(critCost * 1.8);
      currentQuizType = 'applied';
      createParticle('応用力UP!', '#f59e0b', window.innerWidth / 2, window.innerHeight / 3);
      renderStats();
    }
  };

  document.getElementById('upgradeDefense').onclick = () => {
    if (coins >= defenseCost) {
      coins -= defenseCost;
      defense += 10;
      defenseCost = Math.floor(defenseCost * 1.6);
      currentQuizType = 'advanced';
      createParticle('発展力UP!', '#3b82f6', window.innerWidth / 2, window.innerHeight / 3);
      renderStats();
    }
  };
}

/* ----------------- クイズモーダル ----------------- */
function openQuiz() {
  if (!currentSubject || !currentQuizType) {
    currentQuizType = 'basic'; // デフォルト
  }
  
  const problems = problemDatabase[currentSubject]?.[currentQuizType];
  if (!problems || problems.length === 0) return;
  
  const quiz = problems[Math.floor(Math.random() * problems.length)];
  
  const modal = document.getElementById('quizModal');
  const qEl = document.getElementById('quizQ');
  const optDiv = document.getElementById('quizOptions');
  const msg = document.getElementById('quizMsg');
  const close = document.getElementById('quizClose');
  const timerCircle = document.getElementById('quizTimer');
  const quizTitle = document.getElementById('quizTitle');
  
  // タイトル設定
  const titleMap = {
    'basic': '📚 基礎力問題',
    'applied': '🧠 応用力問題', 
    'advanced': '🎯 発展力問題'
  };
  quizTitle.textContent = titleMap[currentQuizType] || '📚 学習問題';
  
  qEl.textContent = quiz.q;
  optDiv.innerHTML = '';
  msg.textContent = '';
  close.classList.add('hidden');
  
  // タイマー初期化
  quizTimeLeft = 30;
  const timerInterval = setInterval(() => {
    quizTimeLeft--;
    const progress = (30 - quizTimeLeft) / 30;
    const offset = 175.929 * (1 - progress);
    timerCircle.style.strokeDashoffset = offset;
    
    if (quizTimeLeft <= 0) {
      clearInterval(timerInterval);
      msg.textContent = '⏰ 時間切れ！';
      msg.style.color = '#ef4444';
      [...optDiv.children].forEach(b => b.disabled = true);
      close.classList.remove('hidden');
    }
  }, 1000);
  
  quiz.opts.forEach((txt, i) => {
    const btn = document.createElement('button');
    btn.textContent = txt;
    btn.className = 'w-full px-4 py-3 bg-gradient-to-r from-emerald-500 to-emerald-600 hover:from-emerald-600 hover:to-emerald-700 text-white rounded-lg transition-all duration-300 font-medium';
    btn.onclick = () => {
      clearInterval(timerInterval);
      if (i === quiz.ans) {
        const reward = currentQuizType === 'basic' ? 100 : currentQuizType === 'applied' ? 150 : 200;
        const expReward = currentQuizType === 'basic' ? 20 : currentQuizType === 'applied' ? 30 : 40;
        
        msg.textContent = `🎉 正解！コイン+${reward}、EXP+${expReward}`;
        msg.style.color = '#10b981';
        coins += reward;
        gainExp(expReward);
        
        // 正解数カウント
        let correctCount = parseInt(localStorage.getItem('quizCorrect') || '0');
        correctCount++;
        localStorage.setItem('quizCorrect', correctCount);
        
        createParticle(`+${reward} コイン`, '#f59e0b', window.innerWidth / 2 - 50, window.innerHeight / 2);
        createParticle(`+${expReward} EXP`, '#8b5cf6', window.innerWidth / 2 + 50, window.innerHeight / 2);
      } else {
        msg.textContent = '❌ 残念...正解は「' + quiz.opts[quiz.ans] + '」でした';
        msg.style.color = '#ef4444';
      }
      renderStats();
      [...optDiv.children].forEach(b => b.disabled = true);
      close.classList.remove('hidden');
    };
    optDiv.appendChild(btn);
  });
  
  close.onclick = () => {
    clearInterval(timerInterval);
    modal.classList.remove('show');
  };
  
  modal.classList.add('show');
}

/* ----------------- 教科変更ボタン ----------------- */
document.getElementById('changeSubject').onclick = () => {
  document.getElementById('subjectModal').classList.add('show');
};

/* ----------------- ゲーム開始処理の修正 ----------------- */
function startGameLoop() {
  // 初期化
  renderStats();
  renderEnemy();
  renderAchievements();
  
  // バトルループ開始
  if (!window.gameLoopStarted) {
    window.gameLoopStarted = true;
    startBattleLoop();
  }
  
  // ウェルカムメッセージ
  setTimeout(() => {
    showNotification('JUKEN★QUEST へようこそ！');
  }, 1000);
}


/* ----------------- オートセーブ機能 ----------------- */
setInterval(() => {
  const gameData = {
    coins,
    dps,
    critRate,
    defense,
    playerLevel,
    playerExp,
    playerExpMax,
    killCount,
    attackCost,
    critCost,
    defenseCost,
    currentSubject
  };
  localStorage.setItem('jukenQuestSave', JSON.stringify(gameData));
}, 10000);

/* ----------------- ゲームロード機能 ----------------- */
function loadGame() {
  const savedData = localStorage.getItem('jukenQuestSave');
  if (savedData) {
    try {
      const data = JSON.parse(savedData);
      coins = data.coins || 0;
      dps = data.dps || 10;
      critRate = data.critRate || 5;
      defense = data.defense || 0;
      playerLevel = data.playerLevel || 1;
      playerExp = data.playerExp || 0;
      playerExpMax = data.playerExpMax || 100;
      killCount = data.killCount || 0;
      attackCost = data.attackCost || 100;
      critCost = data.critCost || 200;
      defenseCost = data.defenseCost || 150;
      currentSubject = data.currentSubject || '';
      
      // 敵のHPも調整
      enemyHPMax = 100 + (killCount * 15);
      enemyHP = enemyHPMax;
      
      if (currentSubject) {
        document.getElementById('subjectModal').classList.remove('show');
        const subjectNameMap = {
          'history': '📚 歴史',
          'geography': '🗺️ 地理',
          'civics': '🏛️ 公民',
          'chemistry': '🧪 化学',
          'earth': '🌍 地学',
          'biology': '🧬 生物',
          'physics': '⚛️ 物理',
          'english_words': '📝 英単語',
          'english_phrases': '💬 英熟語'
        };
        currentSubjectDiv.textContent = subjectNameMap[currentSubject];
        startGameLoop(); // ← ここを修正
        showNotification('前回のデータを読み込みました！');
      }
    } catch (e) {
      console.log('セーブデータの読み込みに失敗しました');
    }
  }
}

/* ----------------- キーボードショートカット ----------------- */
document.addEventListener('keydown', (e) => {
  switch(e.key) {
    case '1':
      if (coins >= attackCost) document.getElementById('upgradeAttack').click();
      break;
    case '2':
      if (coins >= critCost) document.getElementById('upgradeCrit').click();
      break;
    case '3':
      if (coins >= defenseCost) document.getElementById('upgradeDefense').click();
      break;
    case 'Escape':
      const modal = document.getElementById('quizModal');
      if (modal.classList.contains('show')) {
        document.getElementById('quizClose').click();
      }
      break;
  }
});

/* ----------------- 初期化の修正 ----------------- */
document.addEventListener('DOMContentLoaded', () => {
  console.log('DOM読み込み完了');
  
  // 教科選択の初期化
  initSubjectSelection();
  
  // 強化ボタンの初期化
  initUpgradeButtons();
  
  // セーブデータの読み込み
  loadGame();
  
  console.log('初期化完了');
});

// コンソールメッセージ
console.log('%c🎮 JUKEN★QUEST 教科別学習版', 'color: #10b981; font-size: 20px; font-weight: bold;');
console.log('%cキーボードショートカット: 1,2,3=強化, ESC=モーダル閉じる', 'color: #6b7280;');

</script>
</body>
</html>