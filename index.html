<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JUKEN★QUEST – 日替わり版</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body{font-family:"Noto Sans JP",sans-serif;}
    .modal{display:none;position:fixed;inset:0;background:#0008;align-items:center;justify-content:center;}
    .modal.show{display:flex;}
  </style>
</head>
<body class="bg-slate-100 min-h-screen flex flex-col items-center pt-6 gap-6">

<h1 class="text-2xl font-bold">JUKEN★QUEST <span class="text-sm font-normal">(Daily)</span></h1>
<div id="stats" class="flex gap-4 text-lg"></div>

<!-- HPバー -->
<div class="w-72 bg-gray-300 rounded"><div id="hpBar" class="bg-green-500 h-6 rounded"></div></div>
<div id="enemyName" class="text-sm mb-4"></div>

<button id="upgradeBtn" class="px-4 py-2 bg-indigo-600 text-white rounded shadow disabled:opacity-40">
  攻撃力アップ (￥100)
</button>

<!-- クイズモーダル -->
<div id="quizModal" class="modal">
  <div class="bg-white rounded-xl p-6 w-80 shadow-xl">
    <h2 class="font-bold text-lg mb-2">クイズタイム！</h2>
    <p id="quizQ" class="mb-4"></p>
    <div id="quizOptions" class="flex flex-col gap-2"></div>
    <p id="quizMsg" class="mt-4 font-bold"></p>
    <button id="quizClose" class="mt-4 px-3 py-1 bg-gray-400 text-white rounded hidden">とじる</button>
  </div>
</div>

<script>
/* ----------------- 基本パラメータ ----------------- */
let coins=0, dps=10, enemyHPMax=100, enemyHP=enemyHPMax, killCount=0, quizTimer=0;
const enemyName=document.getElementById('enemyName'), hpBar=document.getElementById('hpBar');
const statsDiv=document.getElementById('stats'), upgradeBtn=document.getElementById('upgradeBtn');

/* ----------------- 全問題プール ----------------- */
const quizAll=[
  {q:'日本国憲法施行年は？',opts:['1945','1946','1947'],ans:2},
  {q:'元素記号Feは？',opts:['銅','鉄','銀'],ans:1},
  {q:'walkの過去形は？',opts:['walked','walking','walks'],ans:0},
  {q:'三角形の内角和は？',opts:['90°','180°','360°'],ans:1},
  {q:'沖縄の県庁所在地は？',opts:['那覇','名古屋','長崎'],ans:0},
  {q:'円周率πを小数第一位まで',opts:['3.1','3.2','3.3'],ans:0},
  {q:'水は何度で凍る？',opts:['0℃','4℃','10℃'],ans:0},
  {q:'世界最大の大陸は？',opts:['アジア','アフリカ','南極'],ans:0},
  {q:'光合成に必要な気体は？',opts:['二酸化炭素','酸素','窒素'],ans:0},
  {q:'地球を回る衛星は？',opts:['月','火星','金星'],ans:0}
];

/* ---------- ① “今日の10問” を決めるロジック ---------- */
// 1970-01-01からの経過日数を整数化
const daySeed=Math.floor(Date.now()/86400000);

// 線形合同法でシード固定のシャッフル → 上位10問を今日のセットに
function todaysQuizPool(){
  let rng=daySeed, pool=[...quizAll];
  for(let i=pool.length-1;i>0;i--){
    rng=(rng*9301+49297)%233280;
    const j=Math.floor(rng/233280*(i+1));
    [pool[i],pool[j]]=[pool[j],pool[i]];
  }
  return pool.slice(0,10);          // ← ここで今日出す数を調整
}
let quizPool=todaysQuizPool();

/* ----------------- 画面更新 ----------------- */
function renderStats(){
  statsDiv.innerHTML=`<span>コイン：<b>${coins}</b></span><span>攻撃力：<b>${dps}/秒</b></span>`;
}
function renderEnemy(){
  enemyName.textContent=`テストモンスター (HP ${enemyHP}/${enemyHPMax})`;
  hpBar.style.width=(enemyHP/enemyHPMax*100)+'%';
}

/* ----------------- バトルループ ----------------- */
setInterval(()=>{
  enemyHP-=dps;
  if(enemyHP<=0){
    coins+=50; killCount++; enemyHPMax=Math.round(enemyHPMax*1.2); enemyHP=enemyHPMax;
  }
  if(++quizTimer>=15){quizTimer=0;openQuiz();}
  renderStats(); renderEnemy();
},1000);

/* ----------------- 強化ボタン ----------------- */
upgradeBtn.onclick=()=>{if(coins>=100){coins-=100;dps+=10;renderStats();}};

/* ----------------- クイズモーダル ----------------- */
function openQuiz(){
  // プールを使い切ったら今日の並びを再生成
  if(quizPool.length===0) quizPool=todaysQuizPool();
  const quiz=quizPool.pop();

  const modal=document.getElementById('quizModal'),
        qEl=document.getElementById('quizQ'),
        optDiv=document.getElementById('quizOptions'),
        msg=document.getElementById('quizMsg'),
        close=document.getElementById('quizClose');

  qEl.textContent=quiz.q; optDiv.innerHTML=''; msg.textContent=''; close.classList.add('hidden');

  quiz.opts.forEach((txt,i)=>{
    const btn=document.createElement('button');
    btn.textContent=txt;
    btn.className='px-3 py-2 bg-emerald-500/80 hover:bg-emerald-600 text-white rounded';
    btn.onclick=()=>{
      if(i===quiz.ans){msg.textContent='正解！コイン＋100'; coins+=100;}
      else{msg.textContent='ざんねん…';}
      renderStats();
      [...optDiv.children].forEach(b=>b.disabled=true);
      close.classList.remove('hidden');
    };
    optDiv.appendChild(btn);
  });
  close.onclick=()=>modal.classList.remove('show');
  modal.classList.add('show');
}
renderStats(); renderEnemy();
</script>
</body>
</html>
